<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ottawa Map with Draggable Circle</title>

  <!-- ‚îÄ‚îÄ‚îÄ Vendor styles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

  <!-- ‚îÄ‚îÄ‚îÄ App styles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <link rel="stylesheet" href="/static/css/map.css" />
</head>

<body>
  <!-- ‚îÄ‚îÄ‚îÄ Radius / filter controls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="controls">
    <label for="radiusInput">Radius&nbsp;(km):&nbsp;</label>
    <input type="number" id="radiusInput" min="0" max="40" step="0.1" value="15" />

    <button id="filterToggle">Filters ‚öôÔ∏è</button>
    <button id="toggleListings" class="map-floating-btn">üè† Listings</button>

    <div id="filterPanel">
      <div class="filter-header">
        <h3>Filter Options</h3>
        <button id="clearFilters" class="clear-filters-btn">üóëÔ∏è Clear All</button>
      </div>

      <!-- Sold-date filter -->
      <fieldset class="filter-section">
        <legend><strong>Sold Date Range</strong></legend>
        <div id="dateRangeSlider"></div>
        <div class="range-labels">
          <span id="labelStart">2019-01-01</span>
          <span id="labelEnd">2024-12-31</span>
        </div>
      </fieldset>

      <!-- Price filter -->
      <fieldset class="filter-section">
        <legend><strong>Price Range</strong></legend>
        <div id="priceRangeSlider"></div>
        <div class="range-labels">
          <span id="labelPriceMin">$0</span>
          <span id="labelPriceMax">$2,000,000</span>
        </div>
      </fieldset>

      <!-- Beds filter -->
      <fieldset class="filter-section">
        <legend><strong>Bedrooms</strong></legend>
        <div id="bedFilter">
          <button class="bed-btn" data-bed="1">1</button>
          <button class="bed-btn" data-bed="2">2</button>
          <button class="bed-btn" data-bed="3">3</button>
          <button class="bed-btn" data-bed="4">4</button>
          <button class="bed-btn" data-bed="5">5+</button>
        </div>
        <p class="filter-hint">üí° Click once for "X or more", twice for "exactly X"</p>
      </fieldset>

      <!-- Property Type filter -->
      <fieldset class="filter-section">
        <legend><strong>Property Type</strong></legend>
        <div id="ptypeFilter">
          <button class="ptype-btn" data-ptype="Condo">Condo</button>
          <button class="ptype-btn" data-ptype="Townhome">Townhome</button>
          <button class="ptype-btn" data-ptype="Single-family">Single-family</button>
          <button class="ptype-btn" data-ptype="Multi-family">Multi-family</button>
        </div>
      </fieldset>
    </div>
  </div>
  <!-- ‚úÖ end controls -->

  <!-- ‚îÄ‚îÄ‚îÄ Main flex layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="appContainer">
    <!-- Collapsible sidebar -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- LEFT SIDEBAR -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="listingsPanel" class="hidden">
      <button class="toolbar-btn" onclick="toggleView()">
        üìä View Insights
      </button>

      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" id="listingSearch" placeholder="Search by address, price‚Ä¶" autocomplete="off" />
      </div>

      <div class="sort-container">
        <label for="sortSelect">Sort By:</label>
        <select id="sortSelect" onchange="sortListings(this.value)">
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
          <option value="desc-price">Highest Price</option>
          <option value="asc-price">Lowest Price</option>
        </select>
      </div>

      <div id="listingRows" class="listing-rows"></div>
      <div id="paginationControls" class="pagination-controls"></div>
    </div>

    <!-- Map + insights column -->
    <div id="mainPanel">
      <div id="map"></div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- MOBILE TAB BAR (Insights | Listings)                     -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="mobile-tab-bar" id="mobileTabBar" style="display:none;">
        <button class="mobile-tab active" data-tab="insights">üìä Insights</button>
        <button class="mobile-tab" data-tab="listings">üè† Listings</button>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- MOBILE LISTINGS (inline below map, not overlay)          -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div id="mobileListingsPanel" class="mobile-listings-panel" style="display:none;">
        <div class="search-container">
          <span class="search-icon">üîç</span>
          <input type="text" id="mobileListingSearch" placeholder="Search by address, price‚Ä¶" autocomplete="off" />
        </div>
        <div class="sort-container">
          <label for="mobileSortSelect">Sort By:</label>
          <select id="mobileSortSelect">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="desc-price">Highest Price</option>
            <option value="asc-price">Lowest Price</option>
          </select>
        </div>
        <div id="mobileListingRows" class="listing-rows"></div>
        <div id="mobilePaginationControls" class="pagination-controls"></div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- INSIGHTS FOOTER (expandable)                            -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div id="insights">
        <!-- LEFT: Cards Grid -->
        <div class="insights-left">
          <div class="summary-cards">
            <div class="card">
              <strong>Listings Sold</strong>
              <span id="stat-count">‚Äì</span>
            </div>
            <div class="card">
              <strong>Average Price</strong>
              <span id="stat-avg">‚Äì</span>
            </div>
            <div class="card">
              <strong>Avg DOM</strong>
              <span id="stat-dom">‚Äì</span>
            </div>
            <div class="card">
              <strong>Max Price</strong>
              <span id="stat-max">‚Äì</span>
            </div>
            <div class="card">
              <strong>Min Price</strong>
              <span id="stat-min">‚Äì</span>
            </div>
            <div class="card">
              <strong>Avg % Diff</strong>
              <span id="stat-diff">‚Äì</span>
            </div>
          </div>
        </div>

        <!-- RIGHT: Chart Section -->
        <div class="insights-right">
          <div class="chart-header">
            <span style="font-weight: 600; color: #555;">Market Trend</span>
            <div class="btn-group">
              <button class="chart-btn active" data-metric="price">Price</button>
              <button class="chart-btn" data-metric="dom">DOM</button>
              <button class="chart-btn" data-metric="diff">% Diff</button>
            </div>
          </div>

          <div class="chart-container-full">
            <canvas id="soldByMonthChart"></canvas>
          </div>
        </div>
      </div>
      <!-- end #mainPanel -->
    </div>
    <!-- end #appContainer -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SCRIPTS                                                  -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/static/js/map.js"></script>
    <script>
      // Simple script to handle chart toggle UI state (logic in map.js)
      document.querySelectorAll('.chart-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          if (window.renderChart) window.renderChart(btn.dataset.metric);
        });
      });
    </script>
</body>

</html>